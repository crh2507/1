<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <title>Trust Wallet PWA</title>
 <style>
   body { font-family: sans-serif; padding: 2em; max-width: 400px; margin: auto; }
   input, button { margin: 0.5em 0; padding: 0.5em; width: 100%; }
   .hidden { display: none; }
   .user-list { font-size: 0.9em; background: #f4f4f4; padding: 0.5em; border-radius: 6px; }
 </style>
</head>
<body>
 <h2>ğŸ’¸ Trust Wallet</h2>

 <div id="auth">
   <input id="nickname" placeholder="Enter nickname" />
   <input id="phone" placeholder="Enter phone number" />
   <input id="pin" type="password" placeholder="Enter PIN" />
   <button id="register">Register / Login</button>
 </div>

 <div id="wallet" class="hidden">
   <p>Welcome, <span id="user"></span></p>
   <p>Balance: <span id="balance">0</span> tokens</p>
   <p>Trust Score: <span id="trust">Not rated</span></p>
   <input id="recipient" placeholder="Send to nickname or phone" />
   <input id="amount" type="number" placeholder="Amount" />
   <button id="send">Send Tokens</button>
   <p id="status"></p>
   <h4>ğŸŒ Registered Users</h4>
   <div id="users" class="user-list"></div>
 </div>

 <script>
   const users = {}; // { phone: { pin, nickname, balance, trust } }
   let currentUser = null;

   function updateUserList() {
     const list = Object.values(users).map(u => `ğŸ”¹ ${u.nickname || 'Unnamed'} (${u.phone})`).join('<br>');
     document.getElementById('users').innerHTML = list || 'No users yet.';
   }

   document.getElementById('register').onclick = () => {
     const phone = document.getElementById('phone').value.trim();
     const pin = document.getElementById('pin').value.trim();
     const nickname = document.getElementById('nickname').value.trim();

     if (!phone || !pin || !nickname) return alert('Fill all fields');

     // Check for nickname conflict
     if (Object.values(users).some(u => u.nickname === nickname && u.phone !== phone)) {
       return alert('Nickname already taken');
     }

     if (!users[phone]) {
       users[phone] = { pin, nickname, balance: 100, trust: 'ğŸŒ± Seedling' };
     } else if (users[phone].pin !== pin) {
       return alert('Incorrect PIN');
     }

     currentUser = phone;
     const user = users[phone];
     document.getElementById('user').textContent = user.nickname;
     document.getElementById('balance').textContent = user.balance;
     document.getElementById('trust').textContent = user.trust;
     document.getElementById('auth').classList.add('hidden');
     document.getElementById('wallet').classList.remove('hidden');
     updateUserList();
   };

   document.getElementById('send').onclick = () => {
     const input = document.getElementById('recipient').value.trim();
     const amount = parseInt(document.getElementById('amount').value);
     const sender = users[currentUser];

     if (!input || isNaN(amount) || amount <= 0) return alert('Valid input required');
     if (sender.balance < amount) return alert('Insufficient balance');

     const recipientEntry = Object.entries(users).find(([p, u]) =>
       p === input || u.nickname === input
     );

     if (!recipientEntry) return alert('Recipient not found');
     const [recipientPhone, recipient] = recipientEntry;

     sender.balance -= amount;
     recipient.balance += amount;

     document.getElementById('balance').textContent = sender.balance;
     document.getElementById('status').textContent = `âœ… Sent ${amount} tokens to ${recipient.nickname}`;
     updateUserList();
   };
 </script>
</body>
</html>
